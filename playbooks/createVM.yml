- name: Create a VM with custom resources
  hosts: 192.168.1.141
  gather_facts: false
  vars_files:
    - vcenter_vars.yml
  tasks:
    - name: Create VM in VMware vCenter
      community.vmware.vmware_guest:
        hostname: '10.1.0.5'
        username: '{{ lookup("env", "vcenter_c", "username") }}'
        password: '{{ lookup("env", "vcenter_c", "password") }}'
        port: 443
        validate_certs: false
        datacenter: "{{ datacenter.name }}"
        cluster: "{{ datacenter.cluster }}"
        folder: "{{ datacenter.folder }}"
        name: "{{ vm.name }}"
        guest_id: "{{ vm.guest_id }}"
        hardware:
          memory_mb: "{{ vm.memory_mb }}"
          num_cpus: "{{ vm.num_cpus }}"
        networks:
          - name: "{{ vm.network.name }}"
        disk:
          - size_gb: "{{ vm.disk_size_gb }}"
            type: "{{ vm.disk_type }}"
            datastore: "{{ datacenter.datastore }}"
        wait_for_ip_address: "{{ vm.wait_ip_address }}"
        state: "{{ vm.state }}"
- name: Create a VM with custom resources
  hosts: 192.168.1.141
  gather_facts: false
  vars_files:
    - vcenter_vars.yml
  tasks:
    - name: Create VM in VMware vCenter
      community.vmware.vmware_guest:
        hostname: '10.1.0.5'
        username: 'r.raafat@vsphere.local'
        password: 'P@ssw0rd'
        validate_certs: false
        datacenter: "{{ datacenter.name }}"
        cluster: "{{ datacenter.cluster }}"
        folder: "{{ datacenter.folder }}"
        name: "{{ vm.name }}"
        guest_id: "{{ vm.guest_id }}"
        hardware:
          memory_mb: "{{ vm.memory_mb }}"
          num_cpus: "{{ vm.num_cpus }}"
        networks:
          - name: "{{ vm.network.name }}"
        disk:
          - size_gb: "{{ vm.disk_size_gb }}"
            type: "{{ vm.disk_type }}"
            datastore: "{{ datacenter.datastore }}"
        wait_for_ip_address: "{{ vm.wait_ip_address }}"
        state: "{{ vm.state }}"
