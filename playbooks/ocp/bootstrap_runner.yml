- name: Power On Bootstrap and Ensure VM-Tools Running
  hosts: localhost
  vars_files:
    - configs.yml
    - vcenter_vars.yml
  tasks:
    # - name: Set the state of a Bootstrap to powerOn
    #   community.vmware.vmware_guest_powerstate:
    #     hostname: "{{ vcenter.hostname }}"
    #     username: "{{ vcenter.username }}"
    #     password: "{{ vcenter.password }}"
    #     validate_certs: "{{ validate_certs }}"
    #     datacenter: "{{ datacenter.name }}"
    #     name: "{{ (vms_info | selectattr('hostname', 'match', 'bootstrap') | first).hw_name }}"
    #     state: powered-on
    #   register: vm
      
    # - name: Wait for VMware tools to become available by name
    #   community.vmware.vmware_guest_tools_wait:
    #     hostname: "{{ vcenter.hostname }}"
    #     username: "{{ vcenter.username }}"
    #     password: "{{ vcenter.password }}"
    #     validate_certs: "{{ validate_certs }}"
    #     datacenter: "{{ datacenter.name }}"
    #     folder: "{{ vm.instance.hw_folder }}"
    #     name: "{{ vm.instance.hw_name }}"
    - name: Change user password in the guest machine
      community.vmware.vmware_vm_shell:
        hostname: "{{ vcenter.hostname }}"
        username: "{{ vcenter.username }}"
        password: "{{ vcenter.password }}"
        validate_certs: "{{ validate_certs }}"
        datacenter: "{{ datacenter.name }}"
        folder: "/Datacenter/vm/Romany"
        vm_id: "Bootstrap-Romany"
        vm_username: "core"
        vm_password: "core"
        vm_shell: "/bin/echo"
        vm_shell_args: "-e 'old_password\nnew_password\nnew_password' | passwd sample > /tmp/$$.txt 2>&1"
      delegate_to: localhost
  

